BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%chocolate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2725101363.66645
 ALGERIA                   |   1997 | 4663854469.00357
 ALGERIA                   |   1996 | 4688350819.53668
 ALGERIA                   |   1995 | 4655363160.06485
 ALGERIA                   |   1994 | 4684165939.45516
 ALGERIA                   |   1993 | 4675764249.01063
 ALGERIA                   |   1992 | 4676404989.98145
 ARGENTINA                 |   1998 | 2705576446.44498
 ARGENTINA                 |   1997 | 4621966841.20853
 ARGENTINA                 |   1996 | 4645679017.91665
 ARGENTINA                 |   1995 | 4601438641.51187
 ARGENTINA                 |   1994 | 4607720815.22487
 ARGENTINA                 |   1993 | 4627841649.33868
 ARGENTINA                 |   1992 |  4637489891.4205
 BRAZIL                    |   1998 | 2749161886.14805
 BRAZIL                    |   1997 | 4682130623.77281
 BRAZIL                    |   1996 |  4689244866.6478
 BRAZIL                    |   1995 | 4661955314.82177
 BRAZIL                    |   1994 | 4663397787.45697
 BRAZIL                    |   1993 | 4694728196.11163
 BRAZIL                    |   1992 | 4700875681.17611
 CANADA                    |   1998 | 2741472939.86019
 CANADA                    |   1997 | 4701139884.78573
 CANADA                    |   1996 | 4695604260.50532
 CANADA                    |   1995 | 4692492352.17978
 CANADA                    |   1994 | 4675342603.73452
 CANADA                    |   1993 | 4657231617.61923
 CANADA                    |   1992 | 4682985296.15066
 CHINA                     |   1998 | 2717590862.20373
 CHINA                     |   1997 | 4680010880.29745
 CHINA                     |   1996 | 4674618663.27522
 CHINA                     |   1995 |  4661569825.3359
 CHINA                     |   1994 | 4649183077.40073
 CHINA                     |   1993 |  4643167912.7515
 CHINA                     |   1992 | 4666260637.49532
 EGYPT                     |   1998 | 2734272098.58366
 EGYPT                     |   1997 | 4678825610.71008
 EGYPT                     |   1996 | 4699197860.98439
 EGYPT                     |   1995 | 4665234177.16576
 EGYPT                     |   1994 | 4669216122.10833
 EGYPT                     |   1993 | 4688879685.61111
 EGYPT                     |   1992 | 4677283657.73421
 ETHIOPIA                  |   1998 |  2759296008.0009
 ETHIOPIA                  |   1997 | 4718432054.61666
 ETHIOPIA                  |   1996 | 4702509323.53592
 ETHIOPIA                  |   1995 | 4734186695.56265
 ETHIOPIA                  |   1994 | 4717269264.65611
 ETHIOPIA                  |   1993 | 4698730103.36348
 ETHIOPIA                  |   1992 | 4716427178.09459
 FRANCE                    |   1998 | 2735310047.53498
 FRANCE                    |   1997 | 4664254642.90039
 FRANCE                    |   1996 | 4694697038.25034
 FRANCE                    |   1995 |  4663308916.9605
 FRANCE                    |   1994 | 4665045291.28952
 FRANCE                    |   1993 | 4668100786.37093
 FRANCE                    |   1992 | 4680613370.73192
 GERMANY                   |   1998 | 2734652066.57552
 GERMANY                   |   1997 |  4668045998.7154
 GERMANY                   |   1996 | 4691175886.61001
 GERMANY                   |   1995 | 4692127519.78533
 GERMANY                   |   1994 | 4663181188.44165
 GERMANY                   |   1993 | 4690114666.20974
 GERMANY                   |   1992 | 4684951643.98794
 INDIA                     |   1998 | 2745293954.67726
 INDIA                     |   1997 | 4687703462.61799
 INDIA                     |   1996 | 4664061633.07621
 INDIA                     |   1995 | 4663195974.13946
 INDIA                     |   1994 | 4670949692.46078
 INDIA                     |   1993 | 4693987584.35573
 INDIA                     |   1992 | 4691608523.63417
 INDONESIA                 |   1998 | 2711101702.62737
 INDONESIA                 |   1997 | 4619551586.84104
 INDONESIA                 |   1996 | 4623074906.31746
 INDONESIA                 |   1995 | 4614479930.90396
 INDONESIA                 |   1994 | 4636767881.95262
 INDONESIA                 |   1993 |  4664083299.6401
 INDONESIA                 |   1992 | 4652427338.95358
 IRAN                      |   1998 |  2712209663.7691
 IRAN                      |   1997 | 4653974521.12939
 IRAN                      |   1996 | 4659551578.37924
 IRAN                      |   1995 | 4635397269.39053
 IRAN                      |   1994 | 4651782868.07734
 IRAN                      |   1993 |  4644094568.3791
 IRAN                      |   1992 | 4635399911.89275
 IRAQ                      |   1998 | 2706122519.67993
 IRAQ                      |   1997 | 4680252804.93822
 IRAQ                      |   1996 | 4667314523.48512
 IRAQ                      |   1995 | 4658657056.28623
 IRAQ                      |   1994 | 4634386742.00584
 IRAQ                      |   1993 | 4659234241.97274
 IRAQ                      |   1992 | 4666913501.60838
 JAPAN                     |   1998 | 2716901887.63745
 JAPAN                     |   1997 | 4636167340.23169
 JAPAN                     |   1996 |  4640389214.5148
 JAPAN                     |   1995 | 4622719356.29261
 JAPAN                     |   1994 | 4632010302.63403
 JAPAN                     |   1993 | 4634178491.31616
 JAPAN                     |   1992 | 4633124296.21968
 JORDAN                    |   1998 | 2720202480.26044
 JORDAN                    |   1997 | 4635354470.71725
 JORDAN                    |   1996 | 4638289042.90649
 JORDAN                    |   1995 | 4664663914.80021
 JORDAN                    |   1994 |  4646215530.2945
 JORDAN                    |   1993 | 4625202409.42204
 JORDAN                    |   1992 | 4634470002.61201
 KENYA                     |   1998 | 2714045801.46375
 KENYA                     |   1997 | 4600148992.69448
 KENYA                     |   1996 | 4640455089.59111
 KENYA                     |   1995 | 4631000214.50336
 KENYA                     |   1994 | 4668351382.52688
 KENYA                     |   1993 | 4621092842.01903
 KENYA                     |   1992 | 4603169130.47697
 MOROCCO                   |   1998 | 2756445441.30621
 MOROCCO                   |   1997 | 4685536939.22724
 MOROCCO                   |   1996 | 4708809398.10562
 MOROCCO                   |   1995 | 4675240727.35068
 MOROCCO                   |   1994 | 4676793393.25337
 MOROCCO                   |   1993 | 4661433613.21135
 MOROCCO                   |   1992 | 4702206094.07252
 MOZAMBIQUE                |   1998 |  2730113837.1242
 MOZAMBIQUE                |   1997 | 4683599593.77396
 MOZAMBIQUE                |   1996 | 4683538082.18171
 MOZAMBIQUE                |   1995 | 4680487173.52351
 MOZAMBIQUE                |   1994 |  4690778727.6651
 MOZAMBIQUE                |   1993 | 4672485943.55667
 MOZAMBIQUE                |   1992 |  4702621981.2906
 PERU                      |   1998 | 2701826704.39438
 PERU                      |   1997 | 4674153203.33068
 PERU                      |   1996 | 4653556885.07516
 PERU                      |   1995 | 4641730455.12979
 PERU                      |   1994 |   4640989598.969
 PERU                      |   1993 | 4626069298.58252
 PERU                      |   1992 | 4635078857.49231
 ROMANIA                   |   1998 | 2731056256.60719
 ROMANIA                   |   1997 | 4639732239.96439
 ROMANIA                   |   1996 | 4651891967.23733
 ROMANIA                   |   1995 | 4638039610.83153
 ROMANIA                   |   1994 | 4660238837.74231
 ROMANIA                   |   1993 | 4628678079.91302
 ROMANIA                   |   1992 |  4637840815.5233
 RUSSIA                    |   1998 | 2723003620.60643
 RUSSIA                    |   1997 | 4655551087.54316
 RUSSIA                    |   1996 |  4661142178.9275
 RUSSIA                    |   1995 | 4654085490.95646
 RUSSIA                    |   1994 | 4668361518.59372
 RUSSIA                    |   1993 | 4672079419.96129
 RUSSIA                    |   1992 | 4679126605.97768
 SAUDI ARABIA              |   1998 | 2733446191.41894
 SAUDI ARABIA              |   1997 | 4633240895.04059
 SAUDI ARABIA              |   1996 | 4647931610.35033
 SAUDI ARABIA              |   1995 | 4656239654.88623
 SAUDI ARABIA              |   1994 | 4650862693.97557
 SAUDI ARABIA              |   1993 | 4646381568.81877
 SAUDI ARABIA              |   1992 | 4640784094.16778
 UNITED KINGDOM            |   1998 | 2735446579.76733
 UNITED KINGDOM            |   1997 | 4670846580.74975
 UNITED KINGDOM            |   1996 | 4681723111.56386
 UNITED KINGDOM            |   1995 | 4666803720.98964
 UNITED KINGDOM            |   1994 | 4710913051.73031
 UNITED KINGDOM            |   1993 | 4667497073.51911
 UNITED KINGDOM            |   1992 | 4691780118.73197
 UNITED STATES             |   1998 | 2733174319.07447
 UNITED STATES             |   1997 | 4683326620.82092
 UNITED STATES             |   1996 | 4685561458.33702
 UNITED STATES             |   1995 | 4676635571.00353
 UNITED STATES             |   1994 | 4671081528.91217
 UNITED STATES             |   1993 | 4693861938.59661
 UNITED STATES             |   1992 | 4674785198.95081
 VIETNAM                   |   1998 | 2742840344.02565
 VIETNAM                   |   1997 | 4647538419.58934
 VIETNAM                   |   1996 | 4692315117.38466
 VIETNAM                   |   1995 | 4647582971.51382
 VIETNAM                   |   1994 | 4663384631.99618
 VIETNAM                   |   1993 | 4682746379.34864
 VIETNAM                   |   1992 | 4679253999.51292
(175 rows)

COMMIT;
COMMIT
