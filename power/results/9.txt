BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%green%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  2749301748.1081
 ALGERIA                   |   1997 | 4709469147.87336
 ALGERIA                   |   1996 | 4695743065.12813
 ALGERIA                   |   1995 | 4696487014.35294
 ALGERIA                   |   1994 | 4682520980.77762
 ALGERIA                   |   1993 |  4688677812.8299
 ALGERIA                   |   1992 | 4708963959.95571
 ARGENTINA                 |   1998 | 2720544140.30819
 ARGENTINA                 |   1997 |  4650691371.7127
 ARGENTINA                 |   1996 |  4660617515.9706
 ARGENTINA                 |   1995 | 4657909356.31149
 ARGENTINA                 |   1994 | 4650403620.98399
 ARGENTINA                 |   1993 | 4648120105.95969
 ARGENTINA                 |   1992 | 4622346242.61412
 BRAZIL                    |   1998 | 2734019708.34104
 BRAZIL                    |   1997 | 4680808068.21229
 BRAZIL                    |   1996 | 4669821151.24437
 BRAZIL                    |   1995 | 4666037832.32248
 BRAZIL                    |   1994 | 4669507190.82052
 BRAZIL                    |   1993 | 4679807469.54656
 BRAZIL                    |   1992 | 4703645590.54507
 CANADA                    |   1998 | 2739586200.76324
 CANADA                    |   1997 | 4685383559.69364
 CANADA                    |   1996 | 4686409882.76602
 CANADA                    |   1995 | 4688074922.35241
 CANADA                    |   1994 | 4666626905.59376
 CANADA                    |   1993 | 4668172289.79521
 CANADA                    |   1992 | 4697920069.96145
 CHINA                     |   1998 | 2736999269.76049
 CHINA                     |   1997 | 4689018262.12474
 CHINA                     |   1996 | 4700450801.33457
 CHINA                     |   1995 | 4663684961.13679
 CHINA                     |   1994 | 4673020574.88654
 CHINA                     |   1993 | 4659290807.42618
 CHINA                     |   1992 | 4675947787.02107
 EGYPT                     |   1998 | 2733431011.74997
 EGYPT                     |   1997 | 4646614203.69922
 EGYPT                     |   1996 | 4686186084.58262
 EGYPT                     |   1995 | 4661959513.52984
 EGYPT                     |   1994 | 4644909878.01895
 EGYPT                     |   1993 | 4659235078.07651
 EGYPT                     |   1992 | 4660382560.86165
 ETHIOPIA                  |   1998 | 2774383660.64099
 ETHIOPIA                  |   1997 | 4696174231.38948
 ETHIOPIA                  |   1996 | 4704443969.32567
 ETHIOPIA                  |   1995 | 4717126444.97843
 ETHIOPIA                  |   1994 | 4718934705.90001
 ETHIOPIA                  |   1993 | 4677704010.55488
 ETHIOPIA                  |   1992 |  4714359232.0416
 FRANCE                    |   1998 | 2752392156.02134
 FRANCE                    |   1997 | 4696412677.21839
 FRANCE                    |   1996 | 4725872675.26675
 FRANCE                    |   1995 | 4706708151.32327
 FRANCE                    |   1994 | 4705959525.12419
 FRANCE                    |   1993 |  4717340064.5776
 FRANCE                    |   1992 | 4710472989.25433
 GERMANY                   |   1998 | 2769816232.57965
 GERMANY                   |   1997 | 4708931420.88846
 GERMANY                   |   1996 | 4695231809.02871
 GERMANY                   |   1995 | 4691001961.50835
 GERMANY                   |   1994 | 4666107002.15806
 GERMANY                   |   1993 | 4696585808.21028
 GERMANY                   |   1992 |  4695979435.2431
 INDIA                     |   1998 | 2735677919.07837
 INDIA                     |   1997 | 4683352524.87248
 INDIA                     |   1996 | 4678143987.14658
 INDIA                     |   1995 | 4679986962.85252
 INDIA                     |   1994 | 4685354430.14812
 INDIA                     |   1993 | 4647944377.48198
 INDIA                     |   1992 | 4670143771.13684
 INDONESIA                 |   1998 | 2748059691.01546
 INDONESIA                 |   1997 | 4669657536.52868
 INDONESIA                 |   1996 | 4674044045.89873
 INDONESIA                 |   1995 | 4671921159.50054
 INDONESIA                 |   1994 | 4667231145.35369
 INDONESIA                 |   1993 |  4661870479.5105
 INDONESIA                 |   1992 | 4675566641.26333
 IRAN                      |   1998 | 2725747327.36324
 IRAN                      |   1997 | 4613995473.51967
 IRAN                      |   1996 | 4632969732.97758
 IRAN                      |   1995 |  4632897802.4259
 IRAN                      |   1994 | 4613546595.26443
 IRAN                      |   1993 | 4625490045.77761
 IRAN                      |   1992 | 4632476320.37799
 IRAQ                      |   1998 | 2743542906.84305
 IRAQ                      |   1997 | 4670758033.12232
 IRAQ                      |   1996 | 4688959932.03751
 IRAQ                      |   1995 | 4658225621.72125
 IRAQ                      |   1994 | 4688486021.81243
 IRAQ                      |   1993 | 4672113298.21512
 IRAQ                      |   1992 | 4682560750.57486
 JAPAN                     |   1998 | 2727441372.04456
 JAPAN                     |   1997 | 4614906061.55082
 JAPAN                     |   1996 | 4656117987.58629
 JAPAN                     |   1995 | 4668310041.55145
 JAPAN                     |   1994 |  4637890717.1581
 JAPAN                     |   1993 | 4642857221.96144
 JAPAN                     |   1992 | 4660662883.12946
 JORDAN                    |   1998 | 2746058577.74483
 JORDAN                    |   1997 | 4677029441.83438
 JORDAN                    |   1996 | 4672939953.46725
 JORDAN                    |   1995 | 4655955538.47473
 JORDAN                    |   1994 | 4675217666.50926
 JORDAN                    |   1993 | 4678113474.68134
 JORDAN                    |   1992 | 4681301769.58567
 KENYA                     |   1998 | 2720137618.53276
 KENYA                     |   1997 | 4611749257.06969
 KENYA                     |   1996 | 4633406823.98013
 KENYA                     |   1995 | 4615253058.04711
 KENYA                     |   1994 | 4621367317.72413
 KENYA                     |   1993 | 4634311056.70819
 KENYA                     |   1992 | 4640740218.09694
 MOROCCO                   |   1998 | 2731385228.90647
 MOROCCO                   |   1997 | 4682951368.77038
 MOROCCO                   |   1996 | 4696038557.00079
 MOROCCO                   |   1995 | 4677044485.95938
 MOROCCO                   |   1994 | 4684209274.23336
 MOROCCO                   |   1993 | 4662275082.68797
 MOROCCO                   |   1992 | 4677785117.24379
 MOZAMBIQUE                |   1998 |  2750151565.9332
 MOZAMBIQUE                |   1997 | 4662446100.71203
 MOZAMBIQUE                |   1996 | 4686166037.86745
 MOZAMBIQUE                |   1995 | 4685017957.66369
 MOZAMBIQUE                |   1994 | 4655065371.82748
 MOZAMBIQUE                |   1993 | 4679643159.02654
 MOZAMBIQUE                |   1992 | 4707114997.00333
 PERU                      |   1998 | 2704921868.30116
 PERU                      |   1997 | 4628583574.75219
 PERU                      |   1996 | 4657922439.75444
 PERU                      |   1995 | 4654768638.17799
 PERU                      |   1994 | 4644776700.34004
 PERU                      |   1993 | 4635435604.19981
 PERU                      |   1992 | 4634794988.30649
 ROMANIA                   |   1998 |  2732658363.9823
 ROMANIA                   |   1997 | 4667085374.64463
 ROMANIA                   |   1996 | 4697388899.57454
 ROMANIA                   |   1995 | 4687595095.72629
 ROMANIA                   |   1994 | 4661312896.15682
 ROMANIA                   |   1993 | 4677310947.43224
 ROMANIA                   |   1992 | 4664521830.96161
 RUSSIA                    |   1998 | 2741052645.36056
 RUSSIA                    |   1997 | 4706271576.76491
 RUSSIA                    |   1996 | 4700039096.58767
 RUSSIA                    |   1995 | 4678720168.37674
 RUSSIA                    |   1994 | 4692988291.07616
 RUSSIA                    |   1993 |  4685128743.7108
 RUSSIA                    |   1992 | 4690013231.75299
 SAUDI ARABIA              |   1998 | 2724824162.15631
 SAUDI ARABIA              |   1997 |  4651620605.1176
 SAUDI ARABIA              |   1996 | 4683412992.52206
 SAUDI ARABIA              |   1995 | 4663810651.23147
 SAUDI ARABIA              |   1994 | 4672810458.26562
 SAUDI ARABIA              |   1993 | 4652683178.58082
 SAUDI ARABIA              |   1992 | 4670134045.44558
 UNITED KINGDOM            |   1998 | 2760045908.23375
 UNITED KINGDOM            |   1997 | 4691691842.62287
 UNITED KINGDOM            |   1996 | 4730453252.44734
 UNITED KINGDOM            |   1995 | 4696655285.41441
 UNITED KINGDOM            |   1994 | 4721571778.71363
 UNITED KINGDOM            |   1993 | 4698783869.52189
 UNITED KINGDOM            |   1992 | 4727198158.72085
 UNITED STATES             |   1998 | 2747159526.02219
 UNITED STATES             |   1997 | 4657674579.11818
 UNITED STATES             |   1996 | 4675294211.94937
 UNITED STATES             |   1995 |  4664164907.9118
 UNITED STATES             |   1994 |  4676083467.9192
 UNITED STATES             |   1993 | 4684570173.70182
 UNITED STATES             |   1992 |   4712518388.442
 VIETNAM                   |   1998 | 2743617930.88231
 VIETNAM                   |   1997 | 4666224111.77588
 VIETNAM                   |   1996 | 4694644593.02139
 VIETNAM                   |   1995 | 4696686656.40535
 VIETNAM                   |   1994 | 4709694670.89806
 VIETNAM                   |   1993 | 4713776654.82138
 VIETNAM                   |   1992 | 4686159151.92451
(175 rows)

COMMIT;
COMMIT
