BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dark%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2747275705.26866
 ALGERIA                   |   1997 | 4667656492.76521
 ALGERIA                   |   1996 | 4694777874.32184
 ALGERIA                   |   1995 | 4664157813.24892
 ALGERIA                   |   1994 | 4664322961.20669
 ALGERIA                   |   1993 | 4641686842.70165
 ALGERIA                   |   1992 | 4679562207.85632
 ARGENTINA                 |   1998 | 2728411676.30253
 ARGENTINA                 |   1997 | 4669636311.50064
 ARGENTINA                 |   1996 | 4681250324.24261
 ARGENTINA                 |   1995 | 4650095717.81382
 ARGENTINA                 |   1994 | 4651312224.96918
 ARGENTINA                 |   1993 | 4643215361.76434
 ARGENTINA                 |   1992 | 4671292480.95371
 BRAZIL                    |   1998 | 2712578211.93582
 BRAZIL                    |   1997 | 4681587762.60657
 BRAZIL                    |   1996 | 4681009558.09026
 BRAZIL                    |   1995 | 4666504312.00112
 BRAZIL                    |   1994 | 4679258314.04913
 BRAZIL                    |   1993 |  4675004392.4483
 BRAZIL                    |   1992 | 4661228684.37811
 CANADA                    |   1998 | 2741203111.41698
 CANADA                    |   1997 | 4694865058.91642
 CANADA                    |   1996 | 4690439854.83519
 CANADA                    |   1995 | 4690364776.17236
 CANADA                    |   1994 | 4687423584.03914
 CANADA                    |   1993 | 4658475054.16245
 CANADA                    |   1992 | 4696664893.13042
 CHINA                     |   1998 | 2746773928.78791
 CHINA                     |   1997 | 4672605701.36396
 CHINA                     |   1996 | 4685000625.42663
 CHINA                     |   1995 | 4669859976.98921
 CHINA                     |   1994 | 4654635256.23745
 CHINA                     |   1993 | 4668569123.28854
 CHINA                     |   1992 | 4682667802.98907
 EGYPT                     |   1998 |  2738102403.7897
 EGYPT                     |   1997 | 4661912651.15412
 EGYPT                     |   1996 |  4671737682.8763
 EGYPT                     |   1995 | 4670595841.68732
 EGYPT                     |   1994 | 4644548604.08121
 EGYPT                     |   1993 | 4681701234.83409
 EGYPT                     |   1992 | 4704214976.94941
 ETHIOPIA                  |   1998 |  2761380093.2137
 ETHIOPIA                  |   1997 | 4702984526.93233
 ETHIOPIA                  |   1996 | 4722856938.16142
 ETHIOPIA                  |   1995 | 4699020894.19619
 ETHIOPIA                  |   1994 | 4714656594.87093
 ETHIOPIA                  |   1993 | 4715359994.04547
 ETHIOPIA                  |   1992 |  4725949997.8104
 FRANCE                    |   1998 |    2730773366.41
 FRANCE                    |   1997 | 4713253416.07651
 FRANCE                    |   1996 | 4699305587.64754
 FRANCE                    |   1995 | 4653207279.51198
 FRANCE                    |   1994 | 4685585909.05497
 FRANCE                    |   1993 | 4672441960.87856
 FRANCE                    |   1992 | 4688225822.98177
 GERMANY                   |   1998 | 2746038841.47628
 GERMANY                   |   1997 | 4680606492.82144
 GERMANY                   |   1996 | 4696991129.91092
 GERMANY                   |   1995 | 4680751893.02233
 GERMANY                   |   1994 |  4691660191.9605
 GERMANY                   |   1993 | 4678981949.75136
 GERMANY                   |   1992 | 4692695803.05233
 INDIA                     |   1998 | 2750549834.73716
 INDIA                     |   1997 | 4699373020.02207
 INDIA                     |   1996 | 4730144002.48423
 INDIA                     |   1995 |  4708819757.5977
 INDIA                     |   1994 | 4707437501.32819
 INDIA                     |   1993 | 4708786409.06826
 INDIA                     |   1992 | 4715444329.34618
 INDONESIA                 |   1998 | 2724464971.62543
 INDONESIA                 |   1997 | 4615504916.40331
 INDONESIA                 |   1996 | 4635618706.98469
 INDONESIA                 |   1995 | 4630663775.41171
 INDONESIA                 |   1994 | 4634865607.42928
 INDONESIA                 |   1993 | 4635513961.67096
 INDONESIA                 |   1992 | 4634960798.99941
 IRAN                      |   1998 | 2708733919.79436
 IRAN                      |   1997 | 4626732301.25253
 IRAN                      |   1996 | 4629603860.41734
 IRAN                      |   1995 | 4633846085.90623
 IRAN                      |   1994 | 4610263102.97697
 IRAN                      |   1993 | 4603390507.98386
 IRAN                      |   1992 | 4632276457.53659
 IRAQ                      |   1998 | 2720906596.62017
 IRAQ                      |   1997 | 4631465100.00597
 IRAQ                      |   1996 |  4642553064.9571
 IRAQ                      |   1995 | 4631447619.92088
 IRAQ                      |   1994 | 4655179964.88887
 IRAQ                      |   1993 | 4634684218.12153
 IRAQ                      |   1992 | 4651198187.13953
 JAPAN                     |   1998 | 2712665247.80095
 JAPAN                     |   1997 | 4645198322.07558
 JAPAN                     |   1996 | 4656942100.79538
 JAPAN                     |   1995 | 4617746541.54661
 JAPAN                     |   1994 | 4660750776.32248
 JAPAN                     |   1993 | 4605593964.39598
 JAPAN                     |   1992 | 4642573079.76648
 JORDAN                    |   1998 | 2716977342.26925
 JORDAN                    |   1997 | 4639178841.90211
 JORDAN                    |   1996 | 4658652118.98692
 JORDAN                    |   1995 | 4647129158.76084
 JORDAN                    |   1994 | 4636160819.89592
 JORDAN                    |   1993 | 4663192050.86027
 JORDAN                    |   1992 | 4665932886.78336
 KENYA                     |   1998 | 2724285921.59677
 KENYA                     |   1997 | 4610686993.80818
 KENYA                     |   1996 | 4639380960.28301
 KENYA                     |   1995 | 4615871239.82715
 KENYA                     |   1994 | 4590971843.20287
 KENYA                     |   1993 | 4618484694.85359
 KENYA                     |   1992 | 4618234695.89319
 MOROCCO                   |   1998 |  2760300916.9101
 MOROCCO                   |   1997 | 4715474299.69453
 MOROCCO                   |   1996 |  4701823742.1453
 MOROCCO                   |   1995 | 4731815631.51657
 MOROCCO                   |   1994 | 4689040780.60929
 MOROCCO                   |   1993 | 4712216773.61082
 MOROCCO                   |   1992 | 4733682487.34107
 MOZAMBIQUE                |   1998 | 2738405040.36946
 MOZAMBIQUE                |   1997 |  4671830403.5384
 MOZAMBIQUE                |   1996 | 4671940515.81418
 MOZAMBIQUE                |   1995 | 4676840604.06712
 MOZAMBIQUE                |   1994 | 4679496307.58764
 MOZAMBIQUE                |   1993 | 4665897097.27755
 MOZAMBIQUE                |   1992 | 4680229418.31994
 PERU                      |   1998 | 2707355362.47522
 PERU                      |   1997 |  4633258621.4079
 PERU                      |   1996 | 4634430847.84662
 PERU                      |   1995 | 4630365617.40876
 PERU                      |   1994 | 4635856108.44771
 PERU                      |   1993 | 4641966317.58996
 PERU                      |   1992 | 4638348296.67842
 ROMANIA                   |   1998 | 2720111472.16872
 ROMANIA                   |   1997 | 4668529068.49321
 ROMANIA                   |   1996 |  4677862744.4814
 ROMANIA                   |   1995 |  4666756686.0147
 ROMANIA                   |   1994 | 4660677140.86911
 ROMANIA                   |   1993 | 4677761774.95908
 ROMANIA                   |   1992 | 4674084328.03595
 RUSSIA                    |   1998 | 2723839713.49695
 RUSSIA                    |   1997 | 4679015652.09195
 RUSSIA                    |   1996 | 4672931680.41518
 RUSSIA                    |   1995 | 4638437164.57882
 RUSSIA                    |   1994 | 4643251101.66579
 RUSSIA                    |   1993 | 4652556643.19907
 RUSSIA                    |   1992 | 4666737007.00727
 SAUDI ARABIA              |   1998 | 2729373626.72385
 SAUDI ARABIA              |   1997 |  4637030340.8952
 SAUDI ARABIA              |   1996 | 4694743170.67594
 SAUDI ARABIA              |   1995 | 4668240611.36146
 SAUDI ARABIA              |   1994 | 4674660621.45708
 SAUDI ARABIA              |   1993 | 4665349504.34087
 SAUDI ARABIA              |   1992 | 4667973103.38822
 UNITED KINGDOM            |   1998 | 2765526923.49854
 UNITED KINGDOM            |   1997 | 4717545804.00674
 UNITED KINGDOM            |   1996 | 4723763943.56745
 UNITED KINGDOM            |   1995 | 4710908901.61279
 UNITED KINGDOM            |   1994 | 4697283214.11937
 UNITED KINGDOM            |   1993 | 4710248972.49379
 UNITED KINGDOM            |   1992 | 4685346021.02087
 UNITED STATES             |   1998 | 2748982817.04155
 UNITED STATES             |   1997 | 4677419242.05728
 UNITED STATES             |   1996 | 4689132649.62351
 UNITED STATES             |   1995 | 4694128499.31585
 UNITED STATES             |   1994 | 4685679369.34824
 UNITED STATES             |   1993 |  4689448572.1342
 UNITED STATES             |   1992 | 4700078054.94297
 VIETNAM                   |   1998 | 2755471826.93989
 VIETNAM                   |   1997 | 4684176196.55654
 VIETNAM                   |   1996 | 4673572263.05188
 VIETNAM                   |   1995 | 4700502872.66638
 VIETNAM                   |   1994 | 4694638614.54669
 VIETNAM                   |   1993 | 4665859564.85058
 VIETNAM                   |   1992 | 4679303960.39826
(175 rows)

COMMIT;
COMMIT
